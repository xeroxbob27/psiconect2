<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <title>Psiconect</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<!-- BLOCO DE CÓDIGO REFERENTE AO NAV/BAR -->
<header>
    <nav class="navbar navbar-expand-lg bg-body-tertiary" style="margin-top: 0; padding: 0px;">
        <div class="container-fluid"
            style="background-color: #17375F; font-family: 'parisine-bold'; margin-top: 0; padding: 5px; ">
            <a class="navbar-brand" href="./index.html"><img src="./images/PSICONECT-AZUL-CLARO-FUNDO-AZUL.png"
                    width="120" height="auto"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="inicio" href="./index.html"
                            style="color: #9dc8fd;">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./canais.html" style="color: #9dc8fd;">Canais</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./transtornos.html" style="color: #9dc8fd;">Transtornos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./sobre.html" style="color: #9dc8fd;">Sobre o site</a>
                    </li>
                </ul>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Busca" aria-label="search" />
                    <button class="btn btn-outline-success" type="submit"
                        style="background-color: #17375F;">Buscar</button>
                </form>
            </div>
        </div>
    </nav>
</header>

<body id="pagina">
    <div class="container" id="entrada_comentario" style="border: 4px solid #17375F;">
    <div class="mb-3">
        <label for="nome" class="form-label">Nome</label>
        <input type="text" class="form-control" id="nome" placeholder="Digite seu nome">
    </div>
    <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control" id="email" placeholder="name@example.com">
    </div>
    <div class="mb-3">
        <label for="relato" class="form-label">Conte-nos sua historia</label>
        <textarea class="form-control" id="relato" rows="3"
            placeholder="Nos conte a sua historia"></textarea>
    </div>
    <button type="button" class="btn btn-primary" id="btnPublicar">Publicar</button>
</div>
</body>

<footer id="rodape">
    © Psiconect - Todos direitos reservados
</footer>



<!-- FIM DO BLOCO DE CÓDIGO DE RODA PÉ-->
<script>
document.getElementById("btnPublicar").addEventListener("click", async () => {
    let nome = document.getElementById("nome").value.trim();
    const email = document.getElementById("email").value.trim();
    const relato = document.getElementById("relato").value.trim();

    // Se o nome estiver vazio, define como "Anônimo"
    if (!nome) {
      nome = "Anônimo";
    }

    if (!email || !relato) {
      alert("Preencha o email e o relato!");
      return;
    }

    try {
      const response = await fetch("http://localhost:8800/relato", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nome, email, relato })
      });

      if (!response.ok) {
        throw new Error(`Erro HTTP! Status: ${response.status}`);
      }

      const result = await response.json();
      
      if (result.message) {
        window.location.href = "cadastrosucesso.html";
      }
    } catch (error) {
      console.error("Erro:", error);
      alert("Erro ao enviar relato. Verifique se o servidor está rodando!");
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
    crossorigin="anonymous"></script>